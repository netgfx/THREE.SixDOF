{"version":3,"file":"three-6dof.esm.js","sources":["../src/components/uniforms.ts","../src/components/constants.ts","../src/components/viewer.ts"],"sourcesContent":["export const Uniforms: object = {\n  colorTexture: {\n    type: 't',\n    value: null,\n  },\n  depthTexture: {\n    type: 't',\n    value: null,\n  },\n  time: {\n    type: 'f',\n    value: 0.0,\n  },\n  opacity: {\n    type: 'f',\n    value: 1.0,\n  },\n  pointSize: {\n    type: 'f',\n    value: 3.0,\n  },\n  debugDepth: {\n    type: 'f',\n    value: 0.0,\n  },\n  displacement: {\n    type: 'f',\n    value: 1.0,\n  },\n}\n","enum MeshDensity {\n  LOW = 64,\n  MEDIUM = 128,\n  HIGH = 256,\n  EXTRA_HIGH = 512,\n  EPIC = 1024,\n}\n\nenum Style {\n  WIRE = 0,\n  POINTS = 1,\n  MESH = 2,\n}\n\nenum TextureType {\n  TOP_BOTTOM,\n  SEPERATE,\n}\n\nclass Props {\n  public type: TextureType = TextureType.SEPERATE\n  public density: MeshDensity = MeshDensity.HIGH\n  public style: Style = Style.MESH\n  public displacement: number = 4.0\n  public radius: number = 6\n}\n\nexport { MeshDensity, Style, TextureType, Props }\n","import {\n  Object3D,\n  ShaderMaterial,\n  BackSide,\n  Mesh,\n  Points,\n  SphereBufferGeometry,\n  Texture,\n  NearestFilter,\n  LinearFilter,\n  RGBAFormat,\n  SRGBColorSpace,\n} from './three'\n\n// @ts-ignore\nimport frag from '../shaders/sixdof.frag'\n// @ts-ignore\nimport vert from '../shaders/sixdof.vert'\n\nimport { Uniforms } from './uniforms'\nimport { Style, MeshDensity, TextureType, Props } from './constants'\n\nexport default class Viewer extends Object3D {\n  /** Default props if not provided */\n  private props: Props = new Props()\n\n  private static geometry: SphereBufferGeometry\n  private material: ShaderMaterial = new ShaderMaterial({\n    uniforms: Uniforms,\n    vertexShader: vert,\n    fragmentShader: frag,\n    transparent: true,\n    side: BackSide,\n  })\n\n  constructor(texture: Texture, depth?: Texture, props?: object) {\n    super()\n\n    /** Assign the user provided props, if any */\n    this.setProps(this.props, props)\n\n    // /** Add the compiler definitions needed to pick the right GLSL methods */\n    this.setShaderDefines(this.material, [TextureType[this.props.type]])\n\n    /**\n     * Create the geometry only once, it can be shared between instances\n     *  of the viewer since it's kept as a static class member\n     **/\n    if (!Viewer.geometry) {\n      Viewer.geometry = this.createSphereGeometry(\n        this.props.radius,\n        this.props.density,\n      )\n    }\n\n    /** Assign the textures and update the shader uniforms */\n    this.assignTexture(this.props.type, texture, depth)\n\n    /** Set the displacement using the public setter */\n    this.displacement = this.props.displacement\n\n    /** Create the Mesh/Points and add it to the viewer object */\n    super.add(this.createMesh(Viewer.geometry, this.material, this.props.style))\n  }\n\n  /** Small util to set the defines of the GLSL program based on textureType */\n  private setShaderDefines(\n    material: ShaderMaterial,\n    defines: Array<string>,\n  ): void {\n    defines.forEach(define => (material.defines[define] = ''))\n  }\n\n  /** Internal util to create buffer geometry */\n  private createSphereGeometry(\n    radius: number,\n    meshDensity: MeshDensity,\n  ): SphereBufferGeometry {\n    return new SphereBufferGeometry(radius, meshDensity, meshDensity)\n  }\n\n  /** Internal util to set viewer props from config object */\n  private setProps(viewerProps: Props, userProps?: object): void {\n    if (!userProps) return\n\n    /** Iterate over user provided props and assign to viewer props */\n    for (let prop in userProps) {\n      if (viewerProps[prop]) {\n        viewerProps[prop] = userProps[prop]\n      } else {\n        console.warn(\n          `THREE.SixDOF: Provided ${prop} in config but it is not a valid property and being ignored`,\n        )\n      }\n    }\n  }\n\n  /** Internal util to assign the textures to the shader uniforms */\n  private assignTexture(\n    type: TextureType,\n    colorTexture: Texture,\n    depthTexture?: Texture,\n  ): void {\n    /** Check wheter we are rendering top bottom or just single textures */\n    if (type === TextureType.SEPERATE) {\n      if (!depthTexture)\n        throw new Error(\n          'When using seperate texture type, depthmap must be provided',\n        )\n      this.depth = this.setDefaultTextureProps(depthTexture)\n    }\n\n    /** Assign the main texture */\n    this.texture = this.setDefaultTextureProps(colorTexture)\n  }\n\n  private setDefaultTextureProps(texture: Texture): Texture {\n    texture.minFilter = NearestFilter\n    texture.magFilter = LinearFilter\n    texture.format = RGBAFormat\n    texture.colorSpace = SRGBColorSpace\n    texture.generateMipmaps = false\n    return texture\n  }\n\n  /** An internal util to create the Mesh Object3D */\n  private createMesh(\n    geo: SphereBufferGeometry,\n    mat: ShaderMaterial,\n    style: Style,\n  ): Object3D {\n    switch (style) {\n      case Style.WIRE:\n        if (!this.material.wireframe) this.material.wireframe = true\n        return new Mesh(geo, mat)\n      case Style.MESH:\n        if (this.material.wireframe) this.material.wireframe = false\n        return new Mesh(geo, mat)\n      case Style.POINTS:\n        return new Points(geo, mat)\n    }\n  }\n\n  /** Toggle vieweing texture or depthmap in viewer */\n  public toggleDepthDebug(state?: boolean): void {\n    this.material.uniforms.debugDepth.value =\n      state != undefined ? state : !this.material.uniforms.debugDepth.value\n  }\n\n  /** Setter for displacement amount */\n  public set displacement(val: number) {\n    this.material.uniforms.displacement.value = val\n  }\n\n  /** Setter for depthmap uniform */\n  public set depth(map: Texture) {\n    this.material.uniforms.depthTexture.value = map\n  }\n\n  /** Setter for depthmap uniform */\n  public set texture(map: Texture) {\n    this.material.uniforms.colorTexture.value = map\n  }\n\n  /** Setter for the opacity */\n  public set opacity(val: number) {\n    this.material.uniforms.opacity.value = val\n  }\n\n  /** Setter for the point size */\n  public set pointSize(val: number) {\n    this.material.uniforms.pointSize.value = val\n  }\n\n  /** Getter for the current viewer props */\n  public get config(): Props {\n    return this.props\n  }\n\n  /** Getter for the opacity */\n  public get opacity(): number {\n    return this.material.uniforms.opacity.value\n  }\n\n  /** Getter for the point size */\n  public get pointSize(): number {\n    return this.material.uniforms.pointSize.value\n  }\n\n  /** Getter for displacement amount */\n  public get displacement(): number {\n    return this.material.uniforms.displacement.value\n  }\n\n  /** Getter for texture */\n  public get texture(): Texture {\n    return this.material.uniforms.colorTexture.value\n  }\n\n  /** Getter for the depth texture */\n  public get depth(): Texture {\n    return this.material.uniforms.opacity.value\n  }\n}\n"],"names":["Uniforms","colorTexture","type","value","depthTexture","time","opacity","pointSize","debugDepth","displacement","MeshDensity","Style","TextureType","Props","constructor","SEPERATE","density","HIGH","style","MESH","radius","Viewer","Object3D","texture","depth","props","material","ShaderMaterial","uniforms","vertexShader","vert","fragmentShader","frag","transparent","side","BackSide","setProps","setShaderDefines","geometry","createSphereGeometry","assignTexture","add","createMesh","defines","forEach","define","meshDensity","SphereBufferGeometry","viewerProps","userProps","prop","console","warn","concat","Error","setDefaultTextureProps","minFilter","NearestFilter","magFilter","LinearFilter","format","RGBAFormat","colorSpace","SRGBColorSpace","generateMipmaps","geo","mat","WIRE","wireframe","Mesh","POINTS","Points","toggleDepthDebug","state","undefined","val","map","config"],"mappings":"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"}